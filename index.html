<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>L√¨ X√¨ May M·∫Øn</title>

    <style>
        * {
            box-sizing: border-box;
        }

        html,
        body {
            margin: 0;
            padding: 0;
            height: 100%;
        }

        body {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            font-family: Arial, sans-serif;
            color: white;

            background: url("https://i.pinimg.com/1200x/af/58/aa/af58aa002a5569cab12e692b0b0c5b16.jpg") center center / cover no-repeat fixed;
        }


        h1 {
            text-align: center;
            margin-top: 90px
        }

        p {
            text-align: center;
            font-size: 14px;
            margin: 0;
        }

        .container {
            flex: 1;
            /* chi·∫øm h·∫øt ph·∫ßn c√≤n l·∫°i */
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            padding: 30px;
            align-content: center;
        }

        .envelope {
            aspect-ratio: 2 / 3;
            max-height: 220px;
            width: 100%;
            height: 100%;
            border-radius: 16px;
            cursor: pointer;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            background: linear-gradient(145deg, #ff2a2a, #cc0000);
            box-shadow:
                0 6px 15px rgba(0, 0, 0, 0.5),
                inset 0 3px 8px rgba(255, 255, 255, 0.3);

            font-size: clamp(16px, 2.5vh, 26px);
            transition: all 0.25s ease;
            transform-style: preserve-3d;
        }

        .envelope:hover {
            transform: translateY(-6px) scale(1.05);
            box-shadow:
                0 10px 25px rgba(0, 0, 0, 0.7),
                inset 0 3px 10px rgba(255, 255, 255, 0.4);
        }

        .envelope::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(120deg,
                    transparent,
                    rgba(255, 255, 255, 0.4),
                    transparent);
            transform: rotate(25deg);
            animation: shine 3s infinite;
        }

        @keyframes shine {
            0% {
                transform: translateX(-100%) rotate(25deg);
            }

            100% {
                transform: translateX(100%) rotate(25deg);
            }
        }

        .opened {
            background: linear-gradient(145deg, gold, #ffcc00);
            color: black;
            font-weight: bold;
            animation: openFlip 0.5s ease forwards;
        }

        @keyframes openFlip {
            0% {
                transform: rotateY(0deg) scale(1);
            }

            50% {
                transform: rotateY(90deg) scale(1.1);
            }

            100% {
                transform: rotateY(0deg) scale(1);
            }
        }


        .envelope:active {
            transform: scale(0.95);
        }

        .opened {
            background: gold;
            color: black;
            font-size: 12px;
            font-weight: bold;
            padding: 4px;
            text-align: center;
        }

        #result {
            font-size: 16px;
            padding: 5px;
            min-height: 40px;
        }

        button {
            padding: 8px 14px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin-bottom: 5px;
        }

        #musicBtn {
            position: fixed;
            top: 10px;
            right: 10px;
            font-size: 12px;
            padding: 6px 10px;
        }

        /* ===== POPUP TR√öNG TH∆Ø·ªûNG ===== */
        .win-popup {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 999;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .win-popup.active {
            opacity: 1;
            pointer-events: all;
        }

        .win-box {
            background: linear-gradient(135deg, gold, #ff9900);
            color: black;
            padding: 35px 25px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.8);
            animation: popupZoom 0.4s ease;
        }

        @keyframes popupZoom {
            0% {
                transform: scale(0.3) rotate(-10deg);
                opacity: 0;
            }

            100% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
        }


        .win-box h2 {
            margin: 0 0 10px 0;
            font-size: 22px;
        }

        .win-box p {
            font-size: 20px;
            font-weight: bold;
        }

        @keyframes popScale {
            0% {
                transform: scale(0.5);
            }

            100% {
                transform: scale(1);
            }
        }

        /* ===== CONFETTI ===== */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            top: -10px;
            animation: fall linear forwards;
            z-index: 1000;
            border-radius: 50%;
        }


        @keyframes fall {
            to {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }




        #gameSection {
            display: none;
        }

        #userInfo {
            position: fixed;
            top: 10px;
            left: 10px;
            font-size: 13px;
            background: rgba(0, 0, 0, 0.5);
            padding: 6px 10px;
            border-radius: 8px;
        }

        #historyBox {
            position: fixed;
            bottom: 6px;
            left: 0;
            width: 100%;
            overflow: hidden;
            white-space: nowrap;
            background: rgba(0, 0, 0, 0.6);
            padding: 4px 0;
            font-weight: bold;
        }

        #rankingText {
            display: inline-block;
            padding-left: 100%;
            animation: scrollText 15s linear infinite;
        }

        @keyframes scrollText {
            0% {
                transform: translateX(0);
            }

            100% {
                transform: translateX(-100%);
            }
        }

        /* ===== SHAKE EFFECT ===== */
        @keyframes shake {
            0% {
                transform: rotate(0deg);
            }

            25% {
                transform: rotate(3deg);
            }

            50% {
                transform: rotate(0deg);
            }

            75% {
                transform: rotate(-3deg);
            }

            100% {
                transform: rotate(0deg);
            }
        }

        .shake {
            animation: shake 0.4s ease-in-out infinite;
            filter: drop-shadow(0 0 10px gold);
        }

        /* ===== LOGIN DESIGN X·ªäN ===== */

        #loginOverlay {
            position: fixed;
            inset: 0;
            backdrop-filter: blur(8px);
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .login-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(15px);
            padding: 35px 30px;
            border-radius: 20px;
            width: 300px;
            text-align: center;
            color: white;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            animation: popScale 0.3s ease;
        }

        .login-card h2 {
            margin-bottom: 20px;
        }

        .input-group {
            margin-bottom: 15px;
            position: relative;
        }

        .input-group input {
            width: 100%;
            padding: 10px 12px;
            border-radius: 12px;
            border: none;
            outline: none;
            font-size: 14px;
        }

        .password-group input {
            padding-right: 40px;
        }

        .eye {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            font-size: 16px;
        }

        .login-btn {
            width: 100%;
            padding: 10px;
            border-radius: 12px;
            border: none;
            background: linear-gradient(45deg, #ffcc00, #ff9900);
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
        }

        .login-btn:hover {
            transform: scale(1.05);
        }

        #loginError {
            color: #ffdddd;
            font-size: 13px;
            margin-top: 8px;
        }
    </style>

</head>


<body>

    <h1>üßß cnf247 üßß</h1>
    <p>Ch·ªçn 1 bao l√¨ x√¨ ƒë·ªÉ nh·∫≠n ti·ªÅn!</p>

    <!-- Nh·∫°c n·ªÅn -->
    <audio id="bgMusic" loop preload="auto">
        <source src="https://www.soundjay.com/misc/sounds/bell-ringing-05.mp3" type="audio/mpeg">
    </audio>

    <!-- √Çm thanh m·ªü l√¨ x√¨ -->
    <audio id="openSound" preload="auto">
        <source src="https://www.soundjay.com/buttons/sounds/button-09.mp3" type="audio/mpeg">
    </audio>
    <div id="loginOverlay">
        <div class="login-card">

            <h2>üîê ƒêƒÉng nh·∫≠p</h2>

            <div class="input-group">
                <input type="text" id="username" placeholder="T√†i kho·∫£n">
            </div>

            <div class="input-group password-group">
                <input type="password" id="password" placeholder="M·∫≠t kh·∫©u">
                <span class="eye" id="eyeIcon" onclick="togglePassword()">üôâ</span>
            </div>

            <button class="login-btn" onclick="login()">ƒêƒÉng nh·∫≠p</button>

            <p id="loginError"></p>

        </div>
    </div>

    <!-- <button onclick="clearAllHistory()">üóë X√≥a to√†n b·ªô l·ªãch s·ª≠</button>  -->
    <div id="gameSection">
        <div id="userInfo"></div>
        <button id="musicBtn" onclick="toggleMusic()">üîä B·∫≠t nh·∫°c</button>

        <div class="container" id="game"></div>
        <div id="historyBox"></div>
        <div id="result"></div>



    </div>


    <script>
        let lowestEnvelope = null;
        let hintTimer = null;
        // ===== DANH S√ÅCH USER ƒê∆Ø·ª¢C TR√öNG L·ªöN =====
        const VIP_USERS = ["11111111", "25012853"];
        /* ===== LOGIN SYSTEM ===== */
  

        const ACCOUNTS = [
            { id: "23011585", username: "Th·∫£o Min", password: "cnf@123456" },
            { id: "25013306", username: "Thu H√†", password: "cnf@123456" },
            { id: "25014329", username: "Ph∆∞∆°ng Th·∫£o", password: "cnf@123456" },
            { id: "26014376", username: "B·∫£o B√¨nh", password: "cnf@123456" },
            { id: "25014132", username: "Ti·∫øn Kh·∫£i", password: "cnf@123456" },
            { id: "25012857", username: "H·∫£i H√†", password: "cnf@123456" },
            { id: "25012853", username: "Minh Anh", password: "cnf@123456" },
            { id: "25013594", username: "Qu·ª≥nh Th∆°", password: "cnf@123456" },
            { id: "0985745184", username: "A Tu·∫•nE", password: "cnf@123456" },
            { id: "11111111", username: "test", password: "cnf@123456" },
        ];

        let isLoggedIn = false;

        function login() {

            const user = document.getElementById("username").value;
            const pass = document.getElementById("password").value;
            const error = document.getElementById("loginError");

            const found = ACCOUNTS.find(acc =>
                acc.id === user && acc.password === pass
            );

            if (found) {

                isLoggedIn = true;
                localStorage.setItem("loggedUser", user);

                document.getElementById("userInfo").innerHTML =
                    "üëã Xin ch√†o, <b>" + found.username + "</b> " +
                    '<button onclick="logout()" style="font-size:10px;padding:3px 6px;margin-left:5px;">ƒêƒÉng xu·∫•t</button>';

                document.getElementById("loginOverlay").style.display = "none";
                document.getElementById("gameSection").style.display = "block";

                renderHistory();

            } else {
                error.innerText = "Sai t√†i kho·∫£n ho·∫∑c m·∫≠t kh·∫©u!";
            }
        }


        function logout() {
            localStorage.removeItem("loggedUser");
            location.reload();
        }

        window.onload = function () {

            renderHistory();

            const savedUser = localStorage.getItem("loggedUser");

            if (savedUser) {

                const account = ACCOUNTS.find(acc => acc.id === savedUser);

                if (!account) {
                    localStorage.removeItem("loggedUser");
                    return;
                }

                const confirmLogout = confirm("B·∫°n c√≥ mu·ªën ƒëƒÉng xu·∫•t kh√¥ng?");

                if (confirmLogout) {
                    localStorage.removeItem("loggedUser");
                    return;
                }

                isLoggedIn = true;

                document.getElementById("loginOverlay").style.display = "none";
                document.getElementById("gameSection").style.display = "block";

                // üî• HI·ªÇN TH·ªä USERNAME thay v√¨ ID
                document.getElementById("userInfo").innerHTML =
                    "üëã Xin ch√†o, <b>" + account.username + "</b> " +
                    '<button onclick="logout()" style="font-size:10px;padding:3px 6px;margin-left:5px;">ƒêƒÉng xu·∫•t</button>';

                if (localStorage.getItem("played_" + savedUser)) {
                    played = true;
                }
            }
        };

        const basePrizes = [10000, 20000, 50000, 5000, 40000, 30000];
        let played = false;

        const prizes = [];
        for (let i = 0; i < 4; i++) {
            prizes.push(...basePrizes);
        }

        const bgMusic = document.getElementById("bgMusic");
        const openSound = document.getElementById("openSound");
        const musicBtn = document.getElementById("musicBtn");

        bgMusic.volume = 0.3;

        function shuffle(array) {
            return array.sort(() => Math.random() - 0.5);
        }

        function playOpenSound() {
            openSound.pause();
            openSound.currentTime = 0;
            openSound.play().catch(() => { });
        }

        function toggleMusic() {
            if (bgMusic.paused) {
                bgMusic.play().then(() => {
                    musicBtn.innerText = "üîá T·∫Øt nh·∫°c";
                });
            } else {
                bgMusic.pause();
                musicBtn.innerText = "üîä B·∫≠t nh·∫°c";
            }
        }
        function createGame() {

            const game = document.getElementById("game");
            game.innerHTML = "";
            played = false;

            const currentUser = localStorage.getItem("loggedUser");

            let prizes = [];
            const smallPrizes = [5000, 10000, 15000, 20000, 25000];

            // ===== N·∫øu l√† VIP ‚Üí lu√¥n c√≥ 3 bao ƒë·∫∑c bi·ªát =====
            if (VIP_USERS.includes(currentUser)) {

                for (let i = 0; i < 17; i++) {
                    const randomSmall = smallPrizes[Math.floor(Math.random() * smallPrizes.length)];
                    prizes.push(randomSmall);
                }

                prizes.push(30000);
                prizes.push(40000);
                prizes.push(50000);
            }

            // ===== User th∆∞·ªùng =====
            else {

                if (Math.random() < 0.9) {
                    // 90% ch·ªâ ti·ªÅn nh·ªè
                    for (let i = 0; i < 20; i++) {
                        const randomSmall = smallPrizes[Math.floor(Math.random() * smallPrizes.length)];
                        prizes.push(randomSmall);
                    }
                } else {
                    // 10% c√≥ ƒë·∫∑c bi·ªát
                    for (let i = 0; i < 17; i++) {
                        const randomSmall = smallPrizes[Math.floor(Math.random() * smallPrizes.length)];
                        prizes.push(randomSmall);
                    }

                    prizes.push(30000);
                    prizes.push(40000);
                    prizes.push(50000);
                }
            }

            // X√°o v·ªã tr√≠
            prizes = prizes.sort(() => Math.random() - 0.5);

            prizes.forEach((money) => {

                const envelope = document.createElement("div");
                envelope.classList.add("envelope");
                envelope.innerHTML = "üßß";

                envelope.onclick = function () {

                    if (!isLoggedIn) {
                        alert("Vui l√≤ng ƒëƒÉng nh·∫≠p tr∆∞·ªõc!");
                        return;
                    }

                    const currentUser = localStorage.getItem("loggedUser");

                    if (localStorage.getItem("played_" + currentUser)) {
                        alert("T√†i kho·∫£n n√†y ƒë√£ ch∆°i r·ªìi!");
                        return;
                    }

                    if (played) return;
                    played = true;

                    playOpenSound();

                    let finalMoney = money;

                    // ===== N·∫øu l√† VIP th√¨ √©p tr√∫ng l·ªõn =====
                    if (VIP_USERS.includes(currentUser)) {

                        const bigPrizes = [30000, 40000, 50000];
                        finalMoney = bigPrizes[Math.floor(Math.random() * bigPrizes.length)];
                    }

                    envelope.classList.add("opened");
                    envelope.innerHTML = finalMoney.toLocaleString() + " ƒë";

                    localStorage.setItem("played_" + currentUser, "true");

                    showWinEffect(finalMoney);
                    saveHistory(finalMoney);
                    renderHistory();
                };


                game.appendChild(envelope);
            });
        }
        // ===== HINT: rung 1 bao nh·ªè nh·∫•t sau 3 gi√¢y =====
        clearTimeout(hintTimer);

        hintTimer = setTimeout(() => {

            if (played) return;

            const envelopes = document.querySelectorAll(".envelope");

            // T√¨m bao c√≥ ti·ªÅn nh·ªè nh·∫•t
            let minMoney = Math.min(...prizes);
            let minIndex = prizes.indexOf(minMoney);

            const targetEnvelope = envelopes[minIndex];

            if (targetEnvelope) {
                targetEnvelope.classList.add("shake");

                // Ng·ª´ng rung sau 2 gi√¢y
                setTimeout(() => {
                    targetEnvelope.classList.remove("shake");
                }, 4000);
            }
            

        }, 6000);





        function resetGame() {
            played = false;
            document.getElementById("result").innerHTML = "";
            createGame();
        }

        createGame();



        document.addEventListener("click", function startMusicOnce() {
            if (bgMusic.paused) {
                bgMusic.play().then(() => {
                    musicBtn.innerText = "üîá T·∫Øt nh·∫°c";
                }).catch(() => { });
            }
            document.removeEventListener("click", startMusicOnce);
        });
        function showWinEffect(money) {
            const popup = document.getElementById("winPopup");
            const winAmount = document.getElementById("winAmount");

            winAmount.innerText = money.toLocaleString() + " ƒë";
            popup.classList.add("active");

            createConfetti();
        }

        function closePopup() {
            document.getElementById("winPopup").classList.remove("active");
        }

        function createConfetti() {
            for (let i = 0; i < 80; i++) {
                const confetti = document.createElement("div");
                confetti.classList.add("confetti");

                confetti.style.left = Math.random() * 100 + "vw";
                confetti.style.background =
                    `hsl(${Math.random() * 360}, 100%, 50%)`;

                confetti.style.animationDuration =
                    (Math.random() * 2 + 2) + "s";

                document.body.appendChild(confetti);

                setTimeout(() => confetti.remove(), 4000);
            }

        }
        function saveHistory(amount) {
            const user = localStorage.getItem("loggedUser");
            let history = JSON.parse(localStorage.getItem("history_" + user)) || [];

            history.push(amount);

            localStorage.setItem("history_" + user, JSON.stringify(history));
        }

        function renderHistory() {

            const box = document.getElementById("historyBox");

            let ranking = [];

            for (let key in localStorage) {

                if (key.startsWith("history_")) {

                    const userId = key.replace("history_", "");

                    const account = ACCOUNTS.find(acc => acc.id === userId);

                    const displayName = account ? account.username : userId;

                    const history = JSON.parse(localStorage.getItem(key)) || [];
                    const total = history.reduce((a, b) => a + b, 0);

                    ranking.push({
                        user: displayName,
                        total: total
                    });
                }

            }

            if (ranking.length === 0) {
                box.innerHTML = "<div id='rankingText'>Ch∆∞a c√≥ d·ªØ li·ªáu x·∫øp h·∫°ng.</div>";
                return;
            }

            ranking.sort((a, b) => b.total - a.total);

            let text = "üèÜ B·∫¢NG X·∫æP H·∫†NG: ";

            ranking.forEach((item, index) => {

                let medal = "";

                if (index === 0) medal = "ü•á";
                else if (index === 1) medal = "ü•à";
                else if (index === 2) medal = "ü•â";
                else medal = (index + 1) + ".";

                text += `${medal} ${item.user} - ${item.total.toLocaleString()} ƒë | `;
            });

            box.innerHTML = `<div id="rankingText">${text}</div>`;
        }
        function clearAllHistory() {
            if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a to√†n b·ªô l·ªãch s·ª≠ v√† d·ªØ li·ªáu kh√¥ng?")) {
                localStorage.clear();
                alert("ƒê√£ x√≥a to√†n b·ªô d·ªØ li·ªáu!");
                location.reload();
            }
        }
        function togglePassword() {
            const passInput = document.getElementById("password");
            const icon = document.getElementById("eyeIcon");

            if (passInput.type === "password") {
                passInput.type = "text";
                icon.innerText = "üôà"; // ƒëang hi·ªán m·∫≠t kh·∫©u
            } else {
                passInput.type = "password";
                icon.innerText = "üôâ"; // ƒëang ·∫©n m·∫≠t kh·∫©u
            }
        }


    </script>
    <div class="win-popup" id="winPopup">
        <div class="win-box">
            <h2>üéâ Ch√∫c M·ª´ng üéâ</h2>
            <p id="winAmount"></p>
            <button onclick="closePopup()">ƒê√≥ng</button>
        </div>
    </div>

</body>

</html>